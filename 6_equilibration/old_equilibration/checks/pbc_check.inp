* Final heating using serial code
*

envi OPENMM_PLATFORM  "CUDA"   ! /CUDA/Reference   Use OpenMM platform based on 
envi OPENMM_PRECISION "mixed"   ! /mixed/double    Do calculations in single 

stream /panfs/panasas01/chem/ra15808/aadh/setup.inp

prnlev 5


set buildcrystal ../common/build_crystal2.str
set nonbondspec ../common/non_bond_spec.str

stream @charmmtop/toppar_water_ions_fixed.str
read rtf card name @charmmtop/top_all36_prot.rtf append flex
read rtf card name /panfs/panasas01/chem/ra15808/aadh/data/ra/aadh_topologies.rtf append flex
read para card name @charmmtop/par_all36_prot_mod.prm append flex
read para card name @datadir/ra/aadh_parameters.prm append flex

read psf card name ../common/2agy_final_min.psf
read coord card name ../common/2agy-310k.crd

! setup crystal
stream @buildcrystal
stream @nonbondspec

coor copy comp

faster on

shake fast bonh tol 1.0e-8 para 

energy

write coord card name step0.cor
* after Charmm energy call
*

energy omm 

write coord card name step1.cor
* after OMM energy call 
*

set gamma 1
set echeck = echeck -1

open read card unit 10 name ../common/2agy-310k.res
open write card unit 11 name  step2.res  
open unit 12 write file name  step2.dcd

dynamics leap restart timestep 0.0001 -
     nstep 1 nprint 1 iprfrq 1 isvfrq 1 iunwri 11 iunread 10 -
     iuncrd 12 nsavc 1 -
     firstt 310 finalt 310  -
     ichecw 0 ihtfrq 0 ieqfrq 0 -
     iasors 1 iasvel 1 iscvel 0  -
     ilbfrq 0 inbfrq -1 imgfrq -1 @echeck bycb -
     ntrfq 100 -
     omm langevin gamma @gamma prmc pref 1.0 iprsfrq 25

write coord card name step2.cor
* after OMM dynamics 1 step 
*

stop
